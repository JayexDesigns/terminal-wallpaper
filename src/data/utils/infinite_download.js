import sleep from '../../functions/sleep';

export default async function infinite_download(command, setHistory) {
    let addEntry = (content, type, replace=false) => {
        if (!replace) setHistory(prevHistory => [...prevHistory, {content: content, type: type}]);
        else setHistory(prevHistory => [...prevHistory.slice(0, prevHistory.length-1), {content: content, type: type}]);
    }
    while (true) {
        addEntry("0% [Working]", "warning");
        await sleep(500);
        addEntry("Ign:1 http://dl.google.com/linux/chrome/deb stable InRelease", "text", true);
        addEntry("0% [Connecting to us.archive.ubuntu.com (91.189.91.24)] [Connecting to security.ubuntu]", "warning");
        await sleep(1000);
        addEntry("0% [Waiting for headers]", "warning", true);
        await sleep(200);
        addEntry("Hit:2 http://security.ubuntu.com/ubuntu focal-security InRelease", "text", true);
        addEntry("Hit:3 http://dl.google.com/linux/chrome/deb stable Release", "text");
        addEntry("0% [Waiting for headers]", "warning");
        await sleep(300);
        addEntry("Get:5 http://us.archive.ubuntu.com/ubuntu focal InRelease [255kB]", "text", true);
        addEntry("0% [5 InRelease 2,280 B/255 kB 1%]", "warning");
        await sleep(50);
        addEntry("0% [5 InRelease 16.4 kB/255 kB 6%]", "warning", true);
        await sleep(45);
        addEntry("0% [5 InRelease 40.9 kB/255 kB 16%]", "warning", true);
        await sleep(55);
        addEntry("0% [5 InRelease 59.0 kB/255 kB 23%]", "warning", true);
        await sleep(40);
        addEntry("0% [5 InRelease 147 kB/255 kB 57%]", "warning", true);
        await sleep(60);
        addEntry("0% [5 InRelease 185 kB/255 kB 72%]", "warning", true);
        await sleep(50);
        addEntry("0% [5 InRelease 201 kB/255 kB 79%]", "warning", true);
        await sleep(1000);
        addEntry("Hit:6 http://us.archive.ubuntu.com/ubuntu focal-updates InRelease", "text", true);
        addEntry("0% [Working]", "warning");
        await sleep(300);
        addEntry("0% [Waiting for headers]", "warning", true);
        await sleep(300);
        addEntry("Hit:7 http://us.archive.ubuntu.com/ubuntu focal-backports InRelease", "text", true);
        addEntry("0% [Working]", "warning");
        await sleep(200);
        addEntry("19% [Waiting for headers]", "warning", true);
        await sleep(200);
        addEntry("Get:8 http://us.archive.ubuntu.com/ubuntu focal/main amd64 Packages [977 kB]", "text", true);
        addEntry("19% [8 Packages 8,192 B/977 kB 1%]", "warning");
        await sleep(100);
        addEntry("20% [8 Packages 185 kB/977 kB 19%]", "warning", true);
        await sleep(50);
        addEntry("20% [8 Packages 377 kB/977 kB 39%]", "warning", true);
        await sleep(50);
        addEntry("20% [8 Packages 425 kB/977 kB 43%]", "warning", true);
        await sleep(200);
        addEntry("20% [8 Packages 545 kB/977 kB 56%]", "warning", true);
        await sleep(50);
        addEntry("21% [8 Packages 860 kB/977 kB 88%]", "warning", true);
        await sleep(300);
        addEntry("Get:9 http://us.archive.ubuntu.com/ubuntu focal/main i386 Packages [724 kB]", "text", true);
        addEntry("21% [8 Packages stor 0 B] [9 Packages 8,946 B/724 kB 1%]", "warning");
        await sleep(100);
        addEntry("22% [9 Packages 55.3 kB/724 kB 8%]", "warning", true);
        await sleep(100);
        addEntry("22% [9 Packages 225 kB/724 kB 31%]", "warning", true);
        await sleep(100);
        addEntry("22% [9 Packages 388 kB/724 kB 54%]", "warning", true);
        await sleep(50);
        addEntry("22% [9 Packages 462 kB/724 kB 64%]", "warning", true);
        await sleep(100);
        addEntry("22% [9 Packages 627 kB/724 kB 87%]", "warning", true);
        await sleep(50);
        addEntry("Get:10 http://us.archive.ubuntu.com/ubuntu focal/main amd64 DEP-11 Metadata [516 kB]", "text", true);
        addEntry("23% [9 Packages store 0 B] [10 Components-amd64 65.5 kB/516 kB 13%]", "warning");
        await sleep(50);
        addEntry("23% [10 Components-amd64 150 kB/516 kB 29%]", "warning", true);
        await sleep(200);
        addEntry("23% [10 Components-amd64 325 kB/516 kB 63%]", "warning", true);
        await sleep(100);
        addEntry("23% [10 Components-amd64 485 kB/516 kB 94%]", "warning", true);
        await sleep(50);
        addEntry("23% [10 Components-amd64 501 kB/516 kB 97%]", "warning", true);
        await sleep(150);
        addEntry("Get:11 http://us.archive.ubuntu.com/ubuntu focal/main amd64 DEP-11 48x48 Icons [93.6 kB]", "text", true);
        addEntry("Get:12 http://us.archive.ubuntu.com/ubuntu focal/main amd64 DEP-11 64x64 Icons [164 kB]", "text");
        addEntry("24% [10 Components-amd64 store 0 B] [12 icons 64x64 4,763 B/164 kB 3%]", "warning");
        await sleep(50);
        addEntry("25% [12 icons 64x64 18.9 kB/164 kB 12%]", "warning", true);
        await sleep(100);
        addEntry("25% [12 icons 64x64 40.8 kB/164 kB 25%]", "warning", true);
        await sleep(100);
        addEntry("Get:13 http://us.archive.ubuntu.com/ubuntu focal/universe i386 Packages [4,633 kB]", "text", true);
        addEntry("25% [12 icons 64x64 40.8 kB/164 kB 25%]", "warning");
        await sleep(100);
        addEntry("Get:14 http://us.archive.ubuntu.com/ubuntu focal/universe amd64 Packages [8,628 kB]", "text", true);
        await sleep(500);
        addEntry("Fetched 15,990 kB in 7s (2,284kB/s)", "success");
        await sleep(50);
        addEntry("Reading package lists... Done", "success");
        await sleep(50);
        addEntry("Building dependency tree", "text");
        await sleep(50);
        addEntry("Reading state information... Done", "success");
        await sleep(200);
        addEntry("Setting up linux-modules-extra-5.11.0-40-generic (5.11.0-40.44~20.04.2) ...", "text");
        addEntry("Setting up linux-modules-5.11.0-40-generic (5.11.0-40.44~20.04.2) ...", "text");
        await sleep(1000);
        addEntry("Setting up linux-image-generic-hwe-20.04 (5.11.0.40.44~20.04.18) ...", "text");
        addEntry("Setting up linux-generic-hwe-20.04 (5.11.0.40.44~20.04.18) ...", "text");
        await sleep(650);
        addEntry("Processing triggers for desktop-file-utils (0.24-1ubuntu3) ...", "text");
        await sleep(300);
        addEntry("Processing triggers for mime-support (3.64ubuntu1) ...", "text");
        addEntry("Processing triggers for hicolor-icon-theme (0.17-2) ...", "text");
        await sleep(400);
        addEntry("Processing triggers for gnome-menus (3.36.0-1ubuntu1) ...", "text");
        await sleep(500);
        addEntry("Processing triggers for man-db (2.9.1-1) ...", "text");
        addEntry("Processing triggers for shared-mime-info (1.15-1) ...", "text");
        addEntry("Processing triggers for linux-image-5.11.0-40-generic (5.11.0-40.44~20.04.2) ...", "text");
        await sleep(1000);
        addEntry("/etc/kernel/postinst.d/initramfs-tools:", "text");
        await sleep(500);
        addEntry("update-initramfs: Generating /boot/initrd.img-5.11.0-40-generic", "text");
        await sleep(600);
        addEntry("/etc/kernel/postinst.d/zz-update-grub:", "text");
        await sleep(100);
        addEntry("Sourcing file `/etc/default/grub'", "text");
        addEntry("Sourcing file `/etc/default/grub.d/init-select.cfg'", "text");
        addEntry("Generating grub configuration file ...", "text");
        await sleep(100);
        addEntry("Found linux image: /boot/vmlinuz-5.11.0-40-generic", "text");
        addEntry("Found initrd image: /boot/initrd.img-5.11.0-40-generic", "text");
        addEntry("Found linux image: /boot/vmlinuz-5.11.0-38-generic", "text");
        addEntry("Found initrd image: /boot/initrd.img-5.11.0-38-generic", "text");
        await sleep(500);
        addEntry("Found linux image: /boot/vmlinuz-5.11.0-37-generic", "text");
        addEntry("Found initrd image: /boot/initrd.img-5.11.0-37-generic", "text");
        addEntry("Found memtest86+ image: /boot/memtest86+.elf", "text");
        addEntry("Found memtest86+ image: /boot/memtest86+.bin", "text");
        addEntry("Found memtest86+ image: /boot/memtest86+.bin", "text");
        await sleep(1000);
        addEntry("E: Failed to fetch http://archive.ubuntu.com/ubuntu/dists/xenial-backprots/main/binary-amd64/Packages 500 Operation not permitted [IP: 91.189.91.23 80]", "error");
        addEntry("E: Retrying installation", "error");

        setHistory(prevHistory => {
            if (prevHistory.length >= 50) return [...prevHistory.slice(prevHistory.length-50, prevHistory.length)];
            else return [...prevHistory];
        });

        await sleep(2000);
    }
}